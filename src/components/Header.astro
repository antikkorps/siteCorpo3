---
import HeaderLink from './HeaderLink.astro';
import { getParametresSite, getImageUrl } from '../lib/directus';

const parametres = await getParametresSite();
---

<header id="header" class="bg-white shadow-lg sticky top-0 z-50 transition-transform duration-300">
	<div class="container mx-auto px-4 max-w-6xl">
		<nav class="flex items-center justify-between py-4">
			<!-- Logo -->
			<div class="flex items-center">
				<a href="/" class="flex items-center space-x-3">
					{parametres?.logo ? (
						<img 
							src={getImageUrl(parametres.logo, 150, 50)} 
							alt={parametres.titre || 'MVO Stérilisation'}
							class="h-12 w-auto"
						/>
					) : (
						<span class="text-2xl font-bold mvo-text-blue">
							{parametres?.titre || 'MVO'}
						</span>
					)}
				</a>
			</div>

			<!-- Desktop Navigation -->
			<div class="hidden md:flex items-center space-x-8">
				<HeaderLink href="/">Accueil</HeaderLink>
				<HeaderLink href="/services">Services</HeaderLink>
				<HeaderLink href="/actualites">Actualités</HeaderLink>
				<HeaderLink href="/contact">Contact</HeaderLink>
			</div>

			<!-- Mobile Menu Button -->
			<button 
				id="mobile-menu-button"
				class="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors"
				aria-label="Menu"
			>
				<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
				</svg>
			</button>
		</nav>

		<!-- Mobile Navigation -->
		<div id="mobile-menu" class="md:hidden hidden pb-4">
			<div class="flex flex-col space-y-4">
				<a href="/" class="text-gray-700 hover:text-blue-600 font-medium transition-colors">
					Accueil
				</a>
				<a href="/services" class="text-gray-700 hover:text-blue-600 font-medium transition-colors">
					Services
				</a>
				<a href="/actualites" class="text-gray-700 hover:text-blue-600 font-medium transition-colors">
					Actualités
				</a>
				<a href="/contact" class="text-gray-700 hover:text-blue-600 font-medium transition-colors">
					Contact
				</a>
			</div>
		</div>
	</div>
</header>

<script>
	const mobileMenuButton = document.getElementById('mobile-menu-button');
	const mobileMenu = document.getElementById('mobile-menu');
	const header = document.getElementById('header');

	// Variables pour le scroll
	let lastScrollTop = 0;
	let isScrolling = false;

	// Gestion du menu mobile
	mobileMenuButton?.addEventListener('click', () => {
		mobileMenu?.classList.toggle('hidden');
	});

	// Fonction pour gérer le scroll
	function handleScroll() {
		if (isScrolling) return;
		
		isScrolling = true;
		
		const currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;
		
		// Masquer/afficher la navigation selon la direction du scroll
		if (currentScrollTop > lastScrollTop && currentScrollTop > 100) {
			// Scroll vers le bas - masquer la navigation
			header?.classList.add('-translate-y-full');
		} else if (currentScrollTop < lastScrollTop) {
			// Scroll vers le haut - afficher la navigation
			header?.classList.remove('-translate-y-full');
		}
		
		lastScrollTop = currentScrollTop;
		
		// Délai pour éviter trop d'appels
		setTimeout(() => {
			isScrolling = false;
		}, 100);
	}

	// Écouter les événements de scroll
	window.addEventListener('scroll', handleScroll, { passive: true });
</script>
